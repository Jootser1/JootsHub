# 1Ô∏è‚É£ Utiliser une image l√©g√®re et r√©cente de Node.js
FROM node:20-alpine AS builder

# 2Ô∏è‚É£ D√©finir le dossier de travail dans le conteneur
WORKDIR /app

# 3Ô∏è‚É£ Copier les fichiers n√©cessaires pour l‚Äôinstallation
COPY package.json package-lock.json ./

# 4Ô∏è‚É£ Installer les d√©pendances en mode production
RUN npm ci --only=production

# 5Ô∏è‚É£ Copier tout le code source du projet
COPY . .

# 6Ô∏è‚É£ Construire le projet TypeScript en JavaScript
RUN npm run build

# 7Ô∏è‚É£ √âtape finale : Cr√©er une image l√©g√®re pour l'ex√©cution
FROM node:20-alpine AS runner
WORKDIR /app

# 8Ô∏è‚É£ Copier uniquement les fichiers n√©cessaires depuis l‚Äô√©tape pr√©c√©dente
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/dist ./dist
COPY package.json ./

# 9Ô∏è‚É£ D√©finir l'environnement en production
ENV NODE_ENV=production

# üîü Exposer le port d'√©coute de l'API
EXPOSE 3000

# 1Ô∏è‚É£1Ô∏è‚É£ Lancer le backend avec Node.js
CMD ["node", "dist/main.js"]

